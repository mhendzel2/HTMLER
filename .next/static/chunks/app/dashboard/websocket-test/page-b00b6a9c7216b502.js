(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{3093:function(e,t,s){Promise.resolve().then(s.bind(s,4053))},4053:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var n=s(7437),r=s(2265),c=s(6070),o=s(2869),i=s(5974),a=s(5613),l=s(1671),d=s(2926);let u=(0,s(9205).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var h=s(6865),b=s(3364);function f(){let[e,t]=(0,r.useState)(null),[s,f]=(0,r.useState)(!1),[p,g]=(0,r.useState)("disconnected"),[m,x]=(0,r.useState)(null),y=async()=>{f(!0),t(null);try{console.log("Starting WebSocket test...");let e=await b.n.testWebSocketAccess();if(console.log("WebSocket test results:",e),t(e),!e.hasWebSocketScope){console.log("Testing alternative endpoints...");try{let e=await fetch("/api/test-websocket-access");if(e.ok){let t=await e.json();console.log("Alternative test results:",t)}}catch(e){console.log("Alternative test failed:",e)}}}catch(e){console.error("WebSocket test error:",e),t({hasWebSocketScope:!1,availableChannels:[],error:`Test failed: ${e instanceof Error?e.message:"Unknown error"}`})}f(!1)},v=async()=>{g("connecting"),await b.n.connect();let e=setInterval(()=>{let t=b.n.getStatus();g(t),("connected"===t||"disconnected"===t)&&clearInterval(e)},500);setTimeout(()=>{clearInterval(e),b.n.disconnect(),g("disconnected")},1e4)};return(0,n.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"WebSocket Connection Test"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Test your API access to WebSocket features and real-time data streams"})]}),(0,n.jsxs)("div",{className:"grid gap-6",children:[(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsx)(c.ll,{children:"API Scope Verification"}),(0,n.jsx)(c.SZ,{children:"Check if your API key has access to WebSocket features"})]}),(0,n.jsxs)(c.aY,{className:"space-y-4",children:[(0,n.jsx)(o.z,{onClick:y,disabled:s,className:"w-full",children:s?"Testing API Access...":"Test WebSocket Scope"}),e&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)(a.bZ,{className:e.hasWebSocketScope?"border-green-200":"border-red-200",children:[e.hasWebSocketScope?(0,n.jsx)(l.Z,{className:"h-4 w-4 text-green-500"}):(0,n.jsx)(u,{className:"h-4 w-4 text-red-500"}),(0,n.jsxs)(a.X,{children:[(0,n.jsx)("strong",{children:e.hasWebSocketScope?"WebSocket Access Available":"WebSocket Access Not Available"}),(0,n.jsx)("br",{}),e.error||(e.hasWebSocketScope?"Your API key has access to real-time WebSocket features.":"Your API plan does not include WebSocket access. The system will use polling instead.")]})]}),e.hasWebSocketScope&&e.availableChannels.length>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-sm",children:"Available WebSocket Channels:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:e.availableChannels.map((e,t)=>(0,n.jsx)(i.C,{variant:"outline",children:e},t))})]})]})]})]}),e?.hasWebSocketScope&&(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsx)(c.ll,{children:"WebSocket Connection Test"}),(0,n.jsx)(c.SZ,{children:"Test real-time connection to Unusual Whales WebSocket servers"})]}),(0,n.jsxs)(c.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"connected":return(0,n.jsx)(l.Z,{className:"w-5 h-5 text-green-500"});case"connecting":return(0,n.jsx)(d.Z,{className:"w-5 h-5 text-yellow-500 animate-pulse"});default:return(0,n.jsx)(u,{className:"w-5 h-5 text-red-500"})}})(p),(0,n.jsxs)("span",{className:"font-medium",children:["Connection Status: ",p]})]}),(0,n.jsx)(o.z,{onClick:v,disabled:"connecting"===p,variant:"outline",children:"connecting"===p?"Connecting...":"Test Connection"})]}),"connected"===p&&(0,n.jsxs)(a.bZ,{className:"border-green-200",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4 text-green-500"}),(0,n.jsxs)(a.X,{children:[(0,n.jsx)("strong",{children:"WebSocket Connected Successfully!"}),(0,n.jsx)("br",{}),"Real-time data streaming is now available. Connection will auto-disconnect in 10 seconds."]})]}),"disconnected"===p&&e&&(0,n.jsxs)(a.bZ,{children:[(0,n.jsx)(h.Z,{className:"h-4 w-4"}),(0,n.jsxs)(a.X,{children:["WebSocket connection failed or disconnected. This could be due to:",(0,n.jsxs)("ul",{className:"list-disc ml-4 mt-2",children:[(0,n.jsx)("li",{children:"Network connectivity issues"}),(0,n.jsx)("li",{children:"API key permissions"}),(0,n.jsx)("li",{children:"Server-side restrictions"})]}),"The system will fall back to polling mode for real-time updates."]})]})]})]}),(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsx)(c.ll,{children:"Next Steps"}),(0,n.jsx)(c.SZ,{children:"How to proceed based on your test results"})]}),(0,n.jsx)(c.aY,{children:(0,n.jsx)("div",{className:"space-y-4",children:e?.hasWebSocketScope?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-green-600",children:"✅ WebSocket Available"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"You can now use the Advanced Trading Filters with real-time monitoring. Navigate to the Trading Filters page to start monitoring institutional flow."}),(0,n.jsx)(o.z,{asChild:!0,children:(0,n.jsx)("a",{href:"/dashboard/filters",children:"Go to Trading Filters"})})]}):(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"font-semibold text-orange-600",children:"⚠️ Polling Mode Only"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your API plan doesn't include WebSocket access, but you can still use the Trading Filters in polling mode. Updates will be fetched every 30 seconds to respect rate limits."}),(0,n.jsx)(o.z,{asChild:!0,variant:"outline",children:(0,n.jsx)("a",{href:"/dashboard/filters",children:"Use Trading Filters (Polling)"})})]})})})]})]})]})}},5613:function(e,t,s){"use strict";s.d(t,{X:function(){return l},bZ:function(){return a}});var n=s(7437),r=s(2265),c=s(7712),o=s(4508);let i=(0,c.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),a=r.forwardRef(({className:e,variant:t,...s},r)=>(0,n.jsx)("div",{ref:r,role:"alert",className:(0,o.cn)(i({variant:t}),e),...s}));a.displayName="Alert",r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("h5",{ref:s,className:(0,o.cn)("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";let l=r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("div",{ref:s,className:(0,o.cn)("text-sm [&_p]:leading-relaxed",e),...t}));l.displayName="AlertDescription"},5974:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var n=s(7437);s(2265);var r=s(7712),c=s(4508);let o=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:t,...s}){return(0,n.jsx)("div",{className:(0,c.cn)(o({variant:t}),e),...s})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return l}});var n=s(7437),r=s(2265),c=s(7053),o=s(7712),i=s(4508);let a=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...o},l)=>{let d=r?c.g7:"button";return(0,n.jsx)(d,{className:(0,i.cn)(a({variant:t,size:s,className:e})),ref:l,...o})});l.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return o},aY:function(){return d},ll:function(){return a}});var n=s(7437),r=s(2265),c=s(4508);let o=r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("div",{ref:s,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));o.displayName="Card";let i=r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("div",{ref:s,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",e),...t}));i.displayName="CardHeader";let a=r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("h3",{ref:s,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));a.displayName="CardTitle";let l=r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("p",{ref:s,className:(0,c.cn)("text-sm text-muted-foreground",e),...t}));l.displayName="CardDescription";let d=r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("div",{ref:s,className:(0,c.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",r.forwardRef(({className:e,...t},s)=>(0,n.jsx)("div",{ref:s,className:(0,c.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},4508:function(e,t,s){"use strict";s.d(t,{Z8:function(){return l},cn:function(){return c},fP:function(){return i},p6:function(){return a},xG:function(){return o}});var n=s(1994),r=s(3335);function c(...e){return(0,r.m6)((0,n.W)(e))}function o(e,t="USD"){let s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(s)}function i(e){let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0":t>=1e9?`${(t/1e9).toFixed(2)}B`:t>=1e6?`${(t/1e6).toFixed(2)}M`:t>=1e3?`${(t/1e3).toFixed(2)}K`:t.toFixed(0)}function a(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function l(){let e=new Date(new Date().toLocaleString("en-US",{timeZone:"America/New_York"})),t=e.getHours(),s=e.getMinutes(),n=e.getDay();if(0===n||6===n)return"closed";let r=60*t+s;return r<570?"pre-market":r>=570&&r<960?"open":"after-hours"}},3364:function(e,t,s){"use strict";s.d(t,{n:function(){return r}});class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}async testWebSocketAccess(){try{let e=await fetch("/api/test-websocket-access",{method:"GET",headers:{Accept:"application/json"}}),t=await e.json();if(console.log("WebSocket test response:",t),t.hasWebSocketScope)return{hasWebSocketScope:!0,availableChannels:["gex_strike_expiry:<TICKER>","gex:TICKER","gex_strike:TICKER","price:TICKER","flow-alerts","news","option_trades","option_trades:<TICKER>"]};return{hasWebSocketScope:!1,availableChannels:[],error:t.message||t.error||"WebSocket access not available"}}catch(e){return console.error("WebSocket test error:",e),{hasWebSocketScope:!1,availableChannels:[],error:`WebSocket test failed: ${e instanceof Error?e.message:"Unknown error"}`}}}async connect(){if(this.isConnecting||this.ws?.readyState===WebSocket.OPEN)return!0;this.isConnecting=!0;try{let e=await this.testWebSocketAccess();if(!e.hasWebSocketScope)return console.warn("WebSocket access not available:",e.error),this.isConnecting=!1,!1;let t="wss://api.unusualwhales.com/ws";return console.log("Attempting WebSocket connection to:",t),this.ws=new WebSocket(t),new Promise(e=>{this.ws.onopen=()=>{console.log("WebSocket connected successfully"),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.isConnecting=!1,e(!0)},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);console.log("WebSocket message received:",t),this.handleMessage(t)}catch(t){console.error("Failed to parse WebSocket message:",t,e.data)}},this.ws.onclose=e=>{console.log("WebSocket connection closed:",e.code,e.reason),this.ws=null,this.isConnecting=!1,1e3!==e.code&&this.handleReconnect()},this.ws.onerror=t=>{console.error("WebSocket error:",t),this.isConnecting=!1,e(!1)},setTimeout(()=>{this.isConnecting&&(console.log("WebSocket connection timeout"),this.isConnecting=!1,this.ws&&this.ws.close(),e(!1))},1e4)})}catch(e){return console.error("Failed to establish WebSocket connection:",e),this.isConnecting=!1,!1}}subscribe(e,t){this.subscriptions.has(e)||(this.subscriptions.set(e,new Set),this.ws?.readyState===WebSocket.OPEN&&(console.log("Subscribing to channel:",e),this.ws.send(JSON.stringify({type:"subscribe",channel:e})))),this.subscriptions.get(e).add(t)}unsubscribe(e,t){let s=this.subscriptions.get(e);s&&(t?(s.delete(t),0===s.size&&(this.subscriptions.delete(e),this.ws?.readyState===WebSocket.OPEN&&(console.log("Unsubscribing from channel:",e),this.ws.send(JSON.stringify({type:"unsubscribe",channel:e}))))):(this.subscriptions.delete(e),this.ws?.readyState===WebSocket.OPEN&&(console.log("Unsubscribing from channel:",e),this.ws.send(JSON.stringify({type:"unsubscribe",channel:e})))))}handleMessage(e){if(Array.isArray(e)&&e.length>=2){let[t,s]=e;console.log("Received WebSocket message:",{channel:t,payload:s}),this.subscriptions.has(t)&&this.subscriptions.get(t).forEach(e=>{try{e({channel:t,payload:s,timestamp:Date.now()})}catch(e){console.error("Error in WebSocket callback:",e)}})}else console.log("Received non-array WebSocket message:",e)}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},this.reconnectDelay),this.reconnectDelay=Math.min(2*this.reconnectDelay,3e4)}subscribeToOptionTrades(e){this.subscribe("option_trades",e)}subscribeToTickerOptionTrades(e,t){this.subscribe(`option_trades:${e.toUpperCase()}`,t)}unsubscribeFromOptionTrades(e){this.unsubscribe("option_trades",e)}unsubscribeFromTickerOptionTrades(e,t){this.unsubscribe(`option_trades:${e.toUpperCase()}`,t)}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.subscriptions.clear(),this.reconnectAttempts=0}getStatus(){return this.ws?.readyState===WebSocket.OPEN?"connected":this.isConnecting?"connecting":"disconnected"}constructor(){this.ws=null,this.subscriptions=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.isConnecting=!1}}let r=n.getInstance()},1671:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6865:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(9205).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2926:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(9205).Z)("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])}},function(e){e.O(0,[73,478,117,744],function(){return e(e.s=3093)}),_N_E=e.O()}]);