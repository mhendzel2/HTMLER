"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[383],{5974:function(e,t,s){s.d(t,{C:function(){return o}});var r=s(7437);s(2265);var n=s(7712),i=s(4508);let a=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o({className:e,variant:t,...s}){return(0,r.jsx)("div",{className:(0,i.cn)(a({variant:t}),e),...s})}},2869:function(e,t,s){s.d(t,{z:function(){return l}});var r=s(7437),n=s(2265),i=s(7053),a=s(7712),o=s(4508);let c=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef(({className:e,variant:t,size:s,asChild:n=!1,...a},l)=>{let u=n?i.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(c({variant:t,size:s,className:e})),ref:l,...a})});l.displayName="Button"},6070:function(e,t,s){s.d(t,{Ol:function(){return o},SZ:function(){return l},Zb:function(){return a},aY:function(){return u},ll:function(){return c}});var r=s(7437),n=s(2265),i=s(4508);let a=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));a.displayName="Card";let o=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));o.displayName="CardHeader";let c=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));c.displayName="CardTitle";let l=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));l.displayName="CardDescription";let u=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...t}));u.displayName="CardContent",n.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},2339:function(e,t,s){s.d(t,{SP:function(){return l},dr:function(){return c},mQ:function(){return o},nU:function(){return u}});var r=s(7437),n=s(2265),i=s(1312),a=s(4508);let o=i.fC,c=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.aV,{ref:s,className:(0,a.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));c.displayName=i.aV.displayName;let l=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.xz,{ref:s,className:(0,a.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));l.displayName=i.xz.displayName;let u=n.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.VY,{ref:s,className:(0,a.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));u.displayName=i.VY.displayName},3344:function(e,t,s){s.d(t,{O:function(){return d}});var r=s(257);let n=r.env.UNUSUAL_WHALES_API_BASE_URL||"https://api.unusualwhales.com",i=r.env.UNUSUAL_WHALES_API_KEY;class a extends Error{constructor(e,t,s){super(e),this.status=t,this.response=s,this.name="UnusualWhalesAPIError"}}class o{constructor(){this.rateLimitDelay=100}static getInstance(){return o.instance||(o.instance=new o),o.instance}getHeaders(){let e={Accept:"application/json","Content-Type":"application/json"};return i&&(e.Authorization=`Bearer ${i}`),e}buildUrl(e,t){let s=new URL(`/api${e}`,n);return t&&Object.entries(t).forEach(([e,t])=>{null!=t&&s.searchParams.append(e,String(t))}),s.toString()}async makeRequest(e,t={}){let{method:s="GET",params:r,cache:n="default"}=t;await new Promise(e=>setTimeout(e,this.rateLimitDelay));let i=this.buildUrl(e,r);try{let e=await fetch(i,{method:s,headers:this.getHeaders(),cache:n});if(!e.ok){let t=await e.text().catch(()=>"Unknown error");throw new a(`API request failed: ${e.status} ${e.statusText}`,e.status,t)}return await e.json()}catch(e){if(e instanceof a)throw e;throw new a(`Network error: ${e instanceof Error?e.message:"Unknown error"}`)}}async getMarketTide(e,t=!0,s=!1){let r={};return e&&(r.date=e),r.interval_5m=t,r.otm_only=s,this.makeRequest("/market/market-tide",{params:r,cache:"no-store"})}async getSectorTide(e,t){let s=`/market/${encodeURIComponent(e)}/sector-tide`,r={};return t&&(r.date=t),this.makeRequest(s,{params:r,cache:"no-store"})}async getMarketCorrelations(e,t){let s={};return e&&(s.start_date=e),t&&(s.end_date=t),this.makeRequest("/market/correlations",{params:s})}async getEarningsAfterHours(e,t=50,s=0){let r={limit:t,page:s};return e&&(r.date=e),this.makeRequest("/earnings/afterhours",{params:r})}async getEarningsPreMarket(e,t=50,s=0){let r={limit:t,page:s};return e&&(r.date=e),this.makeRequest("/earnings/premarket",{params:r})}async getEarningsHistorical(e){return this.makeRequest(`/earnings/${e}`)}async getOptionContract(e){return this.makeRequest(`/option-contract/${e}`)}async getOptionContractIntraday(e,t){let s={};return t&&(s.date=t),this.makeRequest(`/option-contract/${e}/intraday`,{params:s})}async getOptionContractVolumeProfile(e){return this.makeRequest(`/option-contract/${e}/volume-profile`)}async getStockOptionsData(e){return this.getStockFlowAlerts(e,!0,!0,50)}async getStockGreeks(e){return this.makeRequest(`/stock/${e}/greeks`)}async getStockOIPerStrike(e){return this.makeRequest(`/stock/${e}/oi-per-strike`)}async getStockOIPerExpiry(e){return this.makeRequest(`/stock/${e}/oi-per-expiry`)}async getStockOptionsVolume(e,t=1){return this.makeRequest(`/stock/${e}/options-volume`,{params:{limit:t}})}async getStockInfo(e){return this.makeRequest(`/stock/${e}`)}async getStockState(e){return this.makeRequest(`/stock/${e}/stock-state`)}async getStockNetPremTicks(e,t){let s={};return t&&(s.date=t),this.makeRequest(`/stock/${e}/net-prem-ticks`,{params:s})}async getStockFlowAlerts(e,t=!0,s=!0,r=100){try{let t=await this.makeRequest("/option-trades/flow-alerts",{params:{limit:2*r}});return t?.data?.data&&(t.data.data=t.data.data.filter(t=>t.underlying_symbol===e.toUpperCase())),t}catch(e){return this.makeRequest("/market/oi-change",{params:{limit:50,page:0}})}}async getFlowAlerts(e=50){return this.makeRequest("/option-trades/flow-alerts",{params:{limit:e}})}async getStockGEX(e){return this.makeRequest(`/stock/${e}/gex`)}async getStockGreekFlow(e,t,s){let r={};return t&&(r.date=t),s&&(r.expiry=s),this.makeRequest(`/stock/${e}/greek-flow`,{params:r})}async getStockMaxPain(e,t){let s={};return t&&(s.date=t),this.makeRequest(`/stock/${e}/max-pain`,{params:s})}async getStockNetPremTicksProcessed(e,t){try{let s=await this.getStockNetPremTicks(e,t);if(!s?.data?.data||!Array.isArray(s.data.data))return s;let{data:r}=s.data,n=["net_call_premium","net_call_volume","net_put_premium","net_put_volume"],i=[];return r.forEach((e,t)=>{e.net_call_premium=parseFloat(e.net_call_premium||"0"),e.net_put_premium=parseFloat(e.net_put_premium||"0"),e.net_call_volume=parseFloat(e.net_call_volume||"0"),e.net_put_volume=parseFloat(e.net_put_volume||"0"),0!==t&&n.forEach(s=>{e[s]=e[s]+i[t-1][s]}),i.push(e)}),{...s,data:{...s.data,data:i}}}catch(t){throw new a(`Failed to get processed net premium ticks for ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}}async getCongressRecentTrades(e=100,t=0,s,r,n,i){let a={limit:e,offset:t};return s&&(a.start_date=s),r&&(a.end_date=r),n&&(a.ticker=n),i&&(a.congress_member=i),this.makeRequest("/congress/recent-trades",{params:a})}async getCongressTopTradedTickers(e=10,t,s){let r={limit:e};return t&&(r.start_date=t),s&&(r.end_date=s),this.makeRequest("/congress/top-traded-tickers",{params:r})}async getAlerts(e,t=!0,s=100,r=0,n,i){let a={intraday_only:t,limit:s,page:r};return e?.length&&e.forEach((e,t)=>{a[`config_ids[${t}]`]=e}),n?.length&&n.forEach((e,t)=>{a[`noti_types[${t}]`]=e}),i&&(a.ticker_symbols=i),this.makeRequest("/alerts",{params:a})}async getAlertConfigurations(){return this.makeRequest("/alerts/configuration")}async getNewsHeadlines(e=50,t=0,s,r,n){let i={limit:e,page:t};return s&&(i.start_date=s),r&&(i.end_date=r),n&&(i.ticker=n),this.makeRequest("/news/headlines",{params:i})}async getInstitutions(){return this.makeRequest("/institutions")}async getInstitutionHoldings(e){return this.makeRequest(`/institution/${encodeURIComponent(e)}/holdings`)}async getInstitutionActivity(e){return this.makeRequest(`/institution/${encodeURIComponent(e)}/activity`)}async getInstitutionSectors(e){return this.makeRequest(`/institution/${encodeURIComponent(e)}/sectors`)}async getETFInflowOutflow(e){return this.makeRequest(`/etfs/${e}/in_outflow`)}async getShortsData(e){return this.makeRequest(`/shorts/${e}/data`)}async getShortsVolumesByExchange(e){return this.makeRequest(`/shorts/${e}/volumes-by-exchange`)}async getShortsFTDs(e){return this.makeRequest(`/shorts/${e}/ftds`)}async getShortsInterestFloat(e){return this.makeRequest(`/shorts/${e}/interest-float`)}async getShortsVolumeAndRatio(e){return this.makeRequest(`/shorts/${e}/volume-and-ratio`)}async getMarketFDACalendar(e,t){let s={};return e&&(s.start_date=e),t&&(s.end_date=t),this.makeRequest("/market/fda-calendar",{params:s})}async getMarketOIChange(e=100,t=0){return this.makeRequest("/market/oi-change",{params:{limit:e,page:t}})}async getNetFlowExpiry(e,t,s,r){let n={};return e&&(n.ticker_symbol=e),t&&(n.tide_type=t),s&&(n.moneyness=s),r&&(n.expiry_category=r),this.makeRequest("/net-flow/expiry",{params:n})}async getStockInterpolatedIV(e,t){let s={};return t?.length&&t.forEach((e,t)=>{s[`days[${t}]`]=e}),this.makeRequest(`/stock/${e}/interpolated-iv`,{params:s})}async getStockNOPE(e){return this.makeRequest(`/stock/${e}/nope`)}async getStockSpotExposures(e,t,s){return t&&s?this.makeRequest(`/stock/${e}/spot-exposures/expiry-strike`,{params:{expiry:t,strike:s}}):this.makeRequest(`/stock/${e}/spot-exposures`)}async getDarkPoolData(e,t,s,r,n){let i={};return t&&(i.start_date=t),s&&(i.end_date=s),r&&(i.min_size=r),n&&(i.min_premium=n),this.makeRequest(`/stock/${e}/darkpool`,{params:i})}async getGroupFlowGreekFlow(e,t){let s=t?`/group-flow/${e}/greek-flow/${t}`:`/group-flow/${e}/greek-flow`;return this.makeRequest(s)}async getInstitutionLatestFilings(e=50,t=0){return this.makeRequest("/institution/latest_filings",{params:{limit:e,page:t}})}async getInstitutionOwnership(e){return this.makeRequest(`/institution/${e}/ownership`)}}let c=o.getInstance();var l=s(3364);class u{static getInstance(){return u.instance||(u.instance=new u),u.instance}constructor(){this.activeFilters=new Map,this.alertSubscriptions=new Map,this.gexSubscriptions=new Map,this.initializePresetFilters()}initializePresetFilters(){this.activeFilters.set("big-money-otm",{id:"big-money-otm",name:"Big Money OTM Whales",description:"Tracks $500K+ premium OTM options targeting institutional plays",enabled:!0,criteria:{minPremium:5e5,side:"ask",moneyness:"OTM",minDTE:14,maxDTE:180,aggressiveness:"sweep"}}),this.activeFilters.set("aggressive-short-term",{id:"aggressive-short-term",name:"Aggressive Short-Term Plays",description:"0-14 DTE high-premium sweeps indicating immediate catalysts",enabled:!0,criteria:{minPremium:1e5,maxDTE:14,side:"ask",aggressiveness:"sweep",minSize:100}}),this.activeFilters.set("dark-pool-correlation",{id:"dark-pool-correlation",name:"Dark Pool Correlation",description:"Large blocks that may correlate with dark pool activity",enabled:!0,criteria:{minPremium:25e4,aggressiveness:"block",minSize:500,minDTE:30,maxDTE:120}}),this.activeFilters.set("gamma-squeeze",{id:"gamma-squeeze",name:"Gamma Squeeze Setup",description:"Identifies potential gamma squeeze scenarios",enabled:!0,criteria:{contractTypes:["call"],side:"ask",moneyness:"OTM",maxDTE:30,minPremium:5e4}}),this.activeFilters.set("unusual-puts",{id:"unusual-puts",name:"Unusual Put Volume",description:"Large put activity indicating hedging or bearish bets",enabled:!1,criteria:{contractTypes:["put"],minPremium:2e5,side:"ask",minSize:200}}),this.activeFilters.set("earnings-plays",{id:"earnings-plays",name:"Earnings Plays",description:"Options activity likely tied to earnings events",enabled:!0,criteria:{maxDTE:45,minPremium:75e3,side:"ask"}})}async startRealTimeMonitoring(){return(await l.n.testWebSocketAccess()).hasWebSocketScope?await l.n.connect()?(l.n.subscribe("flow-alerts",e=>{console.log("Received flow alert data:",e),Array.isArray(e)&&2===e.length&&"flow-alerts"===e[0]?this.processFlowAlert(this.normalizeFlowAlert(e[1])):e.payload?this.processFlowAlert(this.normalizeFlowAlert(e.payload)):this.processFlowAlert(this.normalizeFlowAlert(e))}),l.n.subscribe("news",e=>{console.log("Received news data:",e),Array.isArray(e)&&2===e.length&&"news"===e[0]&&this.processNewsAlert(e[1])}),console.log("Real-time monitoring started with WebSocket"),!0):(console.warn("WebSocket connection failed, falling back to polling"),this.startPollingMode(),!1):(console.warn("WebSocket not available, falling back to polling"),this.startPollingMode(),!1)}startPollingMode(){console.log("Starting polling mode for flow alerts"),setInterval(async()=>{try{await this.pollRecentFlowAlerts()}catch(e){console.error("Error polling flow alerts:",e)}},3e4)}async pollRecentFlowAlerts(){try{let e=await c.getFlowAlerts(50),t=e.data||e;if(Array.isArray(t))for(let e of t)this.processFlowAlert(this.normalizeFlowAlert(e))}catch(e){console.error("Error fetching flow alerts:",e)}}processFlowAlert(e){for(let[t,s]of(console.log("Processing flow alert:",e.ticker,e.premium,e.sentiment),this.activeFilters))if(s.enabled&&this.matchesFilter(e,s.criteria)){console.log(`Alert matches filter: ${s.name}`,e);let r=this.alertSubscriptions.get(t);r&&r(e)}}processNewsAlert(e){console.log("Processing news alert:",e.headline),e.tickers&&e.tickers.length>0&&console.log("News affects tickers:",e.tickers)}matchesFilter(e,t){return(!t.minPremium||!(e.premium<t.minPremium))&&(!t.maxPremium||!(e.premium>t.maxPremium))&&(!t.minDTE||!(e.dte<t.minDTE))&&(!t.maxDTE||!(e.dte>t.maxDTE))&&(!t.side||"both"===t.side||e.side===t.side)&&(!t.moneyness||"any"===t.moneyness||e.moneyness===t.moneyness)&&(!t.contractTypes||!!t.contractTypes.includes(e.type))&&(!t.minSize||!(e.size<t.minSize))&&(!t.aggressiveness||"any"===t.aggressiveness||e.aggressiveness===t.aggressiveness)&&(!t.sweepOnly||"sweep"===e.aggressiveness)&&(!t.blockOnly||"block"===e.aggressiveness)}subscribeToFilter(e,t){this.alertSubscriptions.set(e,t)}unsubscribeFromFilter(e){this.alertSubscriptions.delete(e)}getAvailableFilters(){return Array.from(this.activeFilters.values())}toggleFilter(e,t){let s=this.activeFilters.get(e);s&&(s.enabled=t)}updateFilterCriteria(e,t){let s=this.activeFilters.get(e);s&&(s.criteria={...s.criteria,...t})}async monitorGEX(e,t){console.log(`Starting GEX monitoring for ${e}`),"connected"===l.n.getStatus()?(console.log(`Using WebSocket for real-time GEX data on ${e}`),l.n.subscribe(`gex:${e}`,s=>{console.log(`Received GEX data for ${e}:`,s),Array.isArray(s)&&2===s.length&&s[0]===`gex:${e}`&&t(this.normalizeGEXData(e,s[1]))}),l.n.subscribe(`gex_strike:${e}`,t=>{console.log(`Received strike GEX data for ${e}:`,t),Array.isArray(t)&&2===t.length&&t[0]===`gex_strike:${e}`&&console.log("Strike-level GEX update:",t[1])})):(console.log(`WebSocket not connected for ${e}, falling back to periodic fetching`),this.gexSubscriptions.set(e,t),this.startGEXPolling(e))}startGEXPolling(e){let t=async()=>{try{let t=await c.getStockGEX(e),s=this.normalizeGEXData(e,t),r=this.gexSubscriptions.get(e);r&&r(s)}catch(t){console.error(`Error fetching GEX for ${e}:`,t)}};setInterval(t,6e4),t()}stopGEXMonitoring(e){this.gexSubscriptions.delete(e),l.n.unsubscribe(`gex:${e}`)}normalizeFlowAlert(e){let t=e;Array.isArray(e)&&2===e.length&&"flow-alerts"===e[0]&&(t=e[1]);let s=t.option_chain||t.contract_id||t.contractId,r=t.ticker,n=t.strike,i=t.expiry,a=t.type||"call";if(s&&!r){let e=s.match(/^([A-Z]+)(\d{6})([CP])(\d+)$/);if(e){r=e[1];let t=e[2];a="C"===e[3]?"call":"put",n=parseInt(e[4])/1e3;let s=2e3+parseInt(t.substring(0,2)),o=parseInt(t.substring(2,4)),c=parseInt(t.substring(4,6));i=`${s}-${o.toString().padStart(2,"0")}-${c.toString().padStart(2,"0")}`}}let o=t.underlying_price||t.underlyingPrice||t.price||0,c=t.total_premium||t.premium||0,l=t.total_size||t.size||0,u=t.price||0;return{ticker:r||"UNKNOWN",contractId:s||"",strike:n||0,expiry:i||"",type:a,side:this.determineSide(t),premium:c,size:l,price:u,underlying_price:o,timestamp:t.executed_at||t.timestamp||Date.now(),dte:i?this.calculateDTE(i):0,moneyness:this.calculateMoneyness({strike:n,underlying_price:o,type:a}),aggressiveness:this.determineAggressiveness(t),sentiment:this.calculateSentiment({type:a,side:this.determineSide(t)})}}determineSide(e){if(e.side)return e.side;let t=e.total_ask_side_prem||0,s=e.total_bid_side_prem||0;return t>s?"ask":s>t?"bid":"ask"}determineAggressiveness(e){if(e.aggressiveness)return e.aggressiveness;if(e.aggression)return e.aggression;if(e.has_sweep)return"sweep";if(e.has_floor)return"block";let t=e.total_size||e.size||0;return(e.total_premium||e.premium||0)>1e6&&t>500?"block":t>100?"sweep":"split"}normalizeGEXData(e,t){return{ticker:e,totalGEX:t.total_gex||t.totalGEX||0,flipPoint:t.flip_point||t.flipPoint||0,callGEX:t.call_gex||t.callGEX||0,putGEX:t.put_gex||t.putGEX||0,strikeData:t.strike_data||t.strikeData||[],timestamp:t.timestamp||Date.now()}}calculateDTE(e){let t=new Date(e),s=new Date;return Math.ceil((t.getTime()-s.getTime())/864e5)}calculateMoneyness(e){let t=e.strike,s=e.underlying_price||e.underlyingPrice;return s?Math.abs(t-s)/s<.02?"ATM":"call"===e.type?t>s?"OTM":"ITM":t<s?"OTM":"ITM":"ATM"}calculateSentiment(e){let{type:t,side:s}=e;return"call"===t&&"ask"===s?"bullish":"put"===t&&"ask"===s||"call"===t&&"bid"===s?"bearish":"put"===t&&"bid"===s?"bullish":"neutral"}getFilterStatistics(){return{}}}let d=u.getInstance()},4508:function(e,t,s){s.d(t,{Z8:function(){return l},cn:function(){return i},fP:function(){return o},p6:function(){return c},xG:function(){return a}});var r=s(1994),n=s(3335);function i(...e){return(0,n.m6)((0,r.W)(e))}function a(e,t="USD"){let s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(s)}function o(e){let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0":t>=1e9?`${(t/1e9).toFixed(2)}B`:t>=1e6?`${(t/1e6).toFixed(2)}M`:t>=1e3?`${(t/1e3).toFixed(2)}K`:t.toFixed(0)}function c(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function l(){let e=new Date(new Date().toLocaleString("en-US",{timeZone:"America/New_York"})),t=e.getHours(),s=e.getMinutes(),r=e.getDay();if(0===r||6===r)return"closed";let n=60*t+s;return n<570?"pre-market":n>=570&&n<960?"open":"after-hours"}},3364:function(e,t,s){s.d(t,{n:function(){return n}});class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}async testWebSocketAccess(){try{let e=await fetch("/api/test-websocket-access",{method:"GET",headers:{Accept:"application/json"}}),t=await e.json();if(console.log("WebSocket test response:",t),t.hasWebSocketScope)return{hasWebSocketScope:!0,availableChannels:["gex_strike_expiry:<TICKER>","gex:TICKER","gex_strike:TICKER","price:TICKER","flow-alerts","news","option_trades","option_trades:<TICKER>"]};return{hasWebSocketScope:!1,availableChannels:[],error:t.message||t.error||"WebSocket access not available"}}catch(e){return console.error("WebSocket test error:",e),{hasWebSocketScope:!1,availableChannels:[],error:`WebSocket test failed: ${e instanceof Error?e.message:"Unknown error"}`}}}async connect(){if(this.isConnecting||this.ws?.readyState===WebSocket.OPEN)return!0;this.isConnecting=!0;try{let e=await this.testWebSocketAccess();if(!e.hasWebSocketScope)return console.warn("WebSocket access not available:",e.error),this.isConnecting=!1,!1;let t="wss://api.unusualwhales.com/ws";return console.log("Attempting WebSocket connection to:",t),this.ws=new WebSocket(t),new Promise(e=>{this.ws.onopen=()=>{console.log("WebSocket connected successfully"),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.isConnecting=!1,e(!0)},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);console.log("WebSocket message received:",t),this.handleMessage(t)}catch(t){console.error("Failed to parse WebSocket message:",t,e.data)}},this.ws.onclose=e=>{console.log("WebSocket connection closed:",e.code,e.reason),this.ws=null,this.isConnecting=!1,1e3!==e.code&&this.handleReconnect()},this.ws.onerror=t=>{console.error("WebSocket error:",t),this.isConnecting=!1,e(!1)},setTimeout(()=>{this.isConnecting&&(console.log("WebSocket connection timeout"),this.isConnecting=!1,this.ws&&this.ws.close(),e(!1))},1e4)})}catch(e){return console.error("Failed to establish WebSocket connection:",e),this.isConnecting=!1,!1}}subscribe(e,t){this.subscriptions.has(e)||(this.subscriptions.set(e,new Set),this.ws?.readyState===WebSocket.OPEN&&(console.log("Subscribing to channel:",e),this.ws.send(JSON.stringify({type:"subscribe",channel:e})))),this.subscriptions.get(e).add(t)}unsubscribe(e,t){let s=this.subscriptions.get(e);s&&(t?(s.delete(t),0===s.size&&(this.subscriptions.delete(e),this.ws?.readyState===WebSocket.OPEN&&(console.log("Unsubscribing from channel:",e),this.ws.send(JSON.stringify({type:"unsubscribe",channel:e}))))):(this.subscriptions.delete(e),this.ws?.readyState===WebSocket.OPEN&&(console.log("Unsubscribing from channel:",e),this.ws.send(JSON.stringify({type:"unsubscribe",channel:e})))))}handleMessage(e){if(Array.isArray(e)&&e.length>=2){let[t,s]=e;console.log("Received WebSocket message:",{channel:t,payload:s}),this.subscriptions.has(t)&&this.subscriptions.get(t).forEach(e=>{try{e({channel:t,payload:s,timestamp:Date.now()})}catch(e){console.error("Error in WebSocket callback:",e)}})}else console.log("Received non-array WebSocket message:",e)}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},this.reconnectDelay),this.reconnectDelay=Math.min(2*this.reconnectDelay,3e4)}subscribeToOptionTrades(e){this.subscribe("option_trades",e)}subscribeToTickerOptionTrades(e,t){this.subscribe(`option_trades:${e.toUpperCase()}`,t)}unsubscribeFromOptionTrades(e){this.unsubscribe("option_trades",e)}unsubscribeFromTickerOptionTrades(e,t){this.unsubscribe(`option_trades:${e.toUpperCase()}`,t)}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.subscriptions.clear(),this.reconnectAttempts=0}getStatus(){return this.ws?.readyState===WebSocket.OPEN?"connected":this.isConnecting?"connecting":"disconnected"}constructor(){this.ws=null,this.subscriptions=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.isConnecting=!1}}let n=r.getInstance()}}]);